<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qianxun.admin.provider.mapper.SysRoleMapper">
    <resultMap id="BaseResultMap" type="com.qianxun.admin.api.dto.extend.SysRoleDTO">
        <id column="id" javaType="java.lang.Integer" jdbcType="INTEGER" property="id"/>
        <result column="role_code" javaType="java.lang.String" jdbcType="VARCHAR" property="roleCode"/>
        <result column="created_at" javaType="java.util.Date" jdbcType="TIMESTAMP" property="createdAt"/>
        <result column="updated_at" javaType="java.util.Date" jdbcType="TIMESTAMP" property="updatedAt"/>
        <result column="deleted" javaType="java.lang.Integer" jdbcType="INTEGER" property="deleted"/>
    </resultMap>
    <sql id="sysRoleWithLangSql">
        sys_role.id,
        sys_role.role_code,
        sys_role.created_at,
        sys_role.updated_at,
        sys_role.deleted,
    sys_role_lang.name AS `name`, sys_role_lang.lang_id AS lang_id,
    sys_role_lang.role_desc AS role_desc
    from sys_role LEFT JOIN sys_role_lang ON sys_role.id = sys_role_lang.role_id
        </sql>
    <select id="getSysRolesWithLang" resultMap="BaseResultMap">
        select
        <include refid="sysRoleWithLangSql"/>
        <where>
            AND sys_role_lang.lang_id = #{inputDTO.langId} AND sys_role.deleted != -1
            <if test="inputDTO.query != null and inputDTO.query != ''">
                AND sys_role_lang.`name` LIKE CONCAT('%',#{inputDTO.query},'%')
            </if>
        </where>
        ORDER BY sys_role.created_at DESC
    </select>

    <select id="searchById" resultMap="BaseResultMap">
        select
        <include refid="sysRoleWithLangSql"/>
        <where>
            AND sys_role_lang.lang_id = #{inputDTO.langId} AND sys_role.deleted != -1
            AND sys_role.id = #{inputDTO.id}
        </where>
    </select>
</mapper>
