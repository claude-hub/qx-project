<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qianxun.admin.provider.mapper.SysDeptMapper">
<resultMap id="BaseResultMap" type="com.qianxun.admin.api.dto.extend.SysDeptDTO">
                                        <id column="id" javaType="java.lang.Integer" jdbcType="INTEGER" property="id"/>
                                                            <result column="parent_id" javaType="java.lang.Integer" jdbcType="INTEGER" property="parentId"/>
                                                            <result column="sort" javaType="java.lang.Integer" jdbcType="INTEGER" property="sort"/>
                                                            <result column="created_at" javaType="java.util.Date" jdbcType="TIMESTAMP" property="createdAt"/>
                                                            <result column="updated_at" javaType="java.util.Date" jdbcType="TIMESTAMP" property="updatedAt"/>
                                                            <result column="deleted" javaType="java.lang.Integer" jdbcType="INTEGER" property="deleted"/>
                        </resultMap>
<sql id="sysDeptWithLangSql">
        sys_dept.id,
        sys_dept.parent_id,
        sys_dept.sort,
        sys_dept.created_at,
        sys_dept.updated_at,
        sys_dept.deleted,
    sys_dept_lang.name AS `name`, sys_dept_lang.lang_id AS lang_id
from sys_dept LEFT JOIN sys_dept_lang ON sys_dept.id =
            sys_dept_lang.dept_id
        </sql>
<select id="getSysDeptsWithLang" resultMap="BaseResultMap">
    select
    <include refid="sysDeptWithLangSql"/>
    <where>
        AND sys_dept_lang.lang_id = #{inputDTO.langId} AND sys_dept.deleted != -1
        <if test="inputDTO.query != null and inputDTO.query != ''">
            AND sys_dept_lang.`name` LIKE CONCAT('%',#{inputDTO.query},'%')
        </if>
    </where>
    ORDER BY sys_dept.created_at DESC
</select>

<select id="searchById" resultMap="BaseResultMap">
    select
    <include refid="sysDeptWithLangSql"/>
    <where>
        AND sys_dept_lang.lang_id = #{inputDTO.langId} AND sys_dept.deleted != -1
        AND sys_dept.id = #{inputDTO.id}
    </where>
</select>
</mapper>
